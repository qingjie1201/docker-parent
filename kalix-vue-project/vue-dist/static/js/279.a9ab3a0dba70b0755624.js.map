{"version":3,"sources":["webpack:///src/views/admin/role/roleAuth.vue","webpack:///./src/views/admin/role/roleAuth.vue?7c57","webpack:///./src/views/admin/role/roleAuth.vue"],"names":["roleAuth","model","config","custom_baseDialog","_this","this","url","then","res","children","treeData","id","onCancelClick","getData","_this2","submitComplete","targetURL","ids","response","msg","resetFields","_afterDialogClose","role_roleAuth","render","_vm","_h","$createElement","_c","_self","ref","staticClass","attrs","title","bizKey","formModel","submitCustom","on","update:formModel","$event","staticStyle","max-height","min-height","overflow","border","margin","slot","data","props","defaultProps","node-key","highlight-current","show-checkbox","default-checked-keys","checkedKeys","default-expand-all","empty-text","check-change","checkChange","staticRenderFns","Component","__webpack_require__","normalizeComponent","__webpack_exports__"],"mappings":"4LA8BAA,2CAIAC,EAAA,eACA,uDAGA,iBAEA,kDAIAC,EAAA,wBAEA,6BAIAC,EAAA,wDAOA,+CAGA,IAAAC,EAAAC,+HASA,6CAEA,UACAC,cAFAC,KAAA,SAAAC,uCAMAC,4BAEAC,wKAaAC,6BAGAF,kCAOAG,+JASAD,8FAMAA,iCAEAA,iDAKAA,qBAEAF,6FAgBAI,wDAEA,mCAEAF,8BAGA,IAAAG,EAAAT,sBACA,6BACAK,yCACA,qEAyBA,aACAK,kBACA,yCAvBA,qDACAC,iBACAC,gBAHAV,KAAA,SAAAW,sCAOAC,gBACA,qBACAC,gBACAL,oCAEAI,OACAJ,4BA3IA,iBA+IAM,gCACA,qDACA,qBC1KAC,GADiBC,OAFjB,WAA0B,IAAAC,EAAAnB,KAAaoB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,gBAA0BE,IAAA,iBAAAC,YAAA,WAAAC,OAAmDC,MAAA,OAAAC,OAAA,OAAAC,UAAAV,EAAAU,UAAAlB,UAAAQ,EAAAR,UAAAmB,aAAAX,EAAAW,cAAmHC,IAAKC,mBAAA,SAAAC,GAAoCd,EAAAU,UAAAI,MAAuBX,EAAA,OAAYG,YAAA,UAAAS,aAAmCC,aAAA,QAAAC,aAAA,QAAAC,SAAA,OAAAC,OAAA,oBAAAC,OAAA,iBAAkHb,OAAQc,KAAA,kBAAwBA,KAAA,mBAAuBlB,EAAA,WAAgBE,IAAA,WAAAC,YAAA,cAAAC,OAAgDe,KAAAtB,EAAAd,SAAAqC,MAAAvB,EAAAwB,aAAAC,WAAA,KAAAC,oBAAA,oBAAAC,gBAAA,gBAAAC,uBAAA5B,EAAA6B,YAAAC,qBAAA,qBAAAC,aAAA,UAA4OnB,IAAKoB,eAAAhC,EAAAiC,gBAAgC,MAEj3BC,oBCWjBC,EAbAC,EAAA,OAaAC,CACA7D,EACAsB,GATA,EAEA,KAEA,KAEA,MAUAwC,EAAA,QAAAH,EAAA","file":"static/js/279.a9ab3a0dba70b0755624.js","sourcesContent":["<!--\r\n描述：系统应用-角色管理-权限分配组件\r\n开发人：fengjing\r\n开发日期：2017年12月29日\r\n-->\r\n<template lang=\"pug\">\r\n  kalix-dialog.user-add(\r\n  title='权限分配'\r\n  bizKey=\"role\"\r\n  ref=\"kalixBizDialog\"\r\n  v-bind:formModel.sync=\"formModel\"\r\n  v-bind:targetURL=\"targetURL\"\r\n  v-bind:submitCustom=\"submitCustom\"\r\n  )\r\n    div.el-form(slot=\"dialogFormSlot\" style=\"max-height:550px;min-height:550px;overflow:auto;border: 1px solid #d0d0d0;margin:-30px 0 -20px\")\r\n      el-tree.filter-tree(v-bind:data=\"treeData\" v-bind:props=\"defaultProps\" node-key=\"id\" highlight-current\r\n      show-checkbox v-bind:default-checked-keys=\"checkedKeys\" default-expand-all\r\n      empty-text=\"数据加载中!\" ref=\"baseTree\"\r\n      v-on:check-change=\"checkChange\")\r\n</template>\r\n\r\n<script type=\"text/ecmascript-6\">\r\n  import Message from 'common/message'\r\n  import FormModel from './model'\r\n  import {rolesURL} from '../config.toml'\r\n  import Dialog from '@/components/custom/baseDialog.vue'\r\n  import EventBus from 'common/eventbus'\r\n\r\n  const ON_REFRESH_DATA = 'refreshData'\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        formModel: Object.assign({}, FormModel),\r\n        treeDataURL: '/camel/rest/roles',\r\n        treeData: [],\r\n        defaultProps: {\r\n          children: 'children',\r\n          label: 'name'\r\n        },\r\n        checkedKeys: [],\r\n        ids: [],\r\n        funIds: [],\r\n        targetURL: rolesURL,\r\n        contentMessage: ''\r\n      }\r\n    },\r\n    components: {\r\n      KalixDialog: Dialog\r\n    },\r\n    mounted () {\r\n    },\r\n    watch: {\r\n      formModel: {\r\n        handler: 'watchFormModel'\r\n      }\r\n    },\r\n    methods: {\r\n      // 获取数据\r\n      getData() {\r\n        this.treeData = []\r\n        this.checkedKeys = []\r\n        if (!this.treeDataURL) {\r\n          return\r\n        }\r\n        if (!this.formModel.id) {\r\n          return\r\n        }\r\n        let url = this.treeDataURL + '/' + this.formModel.id + '/authorizations'\r\n        this.axios.request({\r\n          method: 'GET',\r\n          url: url,\r\n          params: {}\r\n        }).then(res => {\r\n          if (res.data.children) {\r\n            this.treeData = res.data.children\r\n            // 获取选中节点, 并设置所有节点disable=true\r\n            this.getCheckedKeys(this.treeData)\r\n          }\r\n        })\r\n      },\r\n      // 获取tree组件中被选中结点的id\r\n      getCheckedKeys(array) {\r\n        if (array && array.length > 0) {\r\n          for (let i = 0; i < array.length; i++) {\r\n            if (array[i].children) {\r\n              // array[i].disabled = true\r\n              if (array[i].children.length === 0) {\r\n                // delete array[i].children\r\n                if (array[i].checked) {\r\n                  this.checkedKeys.push(array[i].id)\r\n                }\r\n              } else {\r\n                this.getCheckedKeys(array[i].children)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      close() {\r\n        this.onCancelClick()\r\n      },\r\n      // 封装数据格式\r\n      getIds(array) {\r\n        if (array && array.length > 0) {\r\n          for (let i = 0; i < array.length; i++) {\r\n            if (array[i].children) {\r\n              // array[i].disabled = true\r\n              if (array[i].parentId === -1 && array[i].checked) {\r\n                this.funIds.push('app:' + array[i].id)\r\n              }\r\n              if (array[i].children.length === 0) {\r\n                // delete array[i].children\r\n                if (array[i].checked) {\r\n                  if (array[i].parentId === '-1') {\r\n                    this.funIds.push('app:' + array[i].id)\r\n                  } else {\r\n                    this.funIds.push('fun:' + array[i].id)\r\n                  }\r\n                }\r\n              } else {\r\n                if (array[i].checked) {\r\n                  this.funIds.push('fun:' + array[i].id)\r\n                }\r\n                this.getIds(array[i].children)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      checkChange(a, b, c) {\r\n        if (b) {\r\n          a.checked = true\r\n        } else if (c) {\r\n          a.checked = true\r\n        } else {\r\n          a.checked = false\r\n        }\r\n      },\r\n      watchFormModel(newVal) {\r\n        this.getData()\r\n        if (newVal.id) {\r\n          this.targetURL = this.targetURL + '/' + newVal.id + '/authorizations'\r\n        }\r\n        this.ids.push(newVal.id)\r\n      },\r\n      // 重写basedialog的提交方法\r\n      submitCustom(baseDialog) {\r\n        this.funIds.push('fun:root')\r\n        this.getIds(this.treeData)\r\n        this.ids.push(this.funIds.join(','))\r\n        baseDialog.$refs.dialogForm.validate((valid) => {\r\n          if (valid) {\r\n            this.axios.request({\r\n              method: baseDialog.isEdit ? 'PUT' : 'POST',\r\n              url: baseDialog.isEdit ? `${this.targetURL}/${this.formModel.id}` : this.targetURL,\r\n              data: this.ids,\r\n              params: {}\r\n            }).then(response => {\r\n              if (response.data.success) {\r\n                Message.success(response.data.msg)\r\n                baseDialog.visible = false\r\n                baseDialog.$refs.dialogForm.resetFields()\r\n                baseDialog.submitComplete()\r\n              } else {\r\n                Message.error(response.data.msg)\r\n                baseDialog.submitComplete()\r\n              }\r\n              // 刷新列表\r\n              EventBus.$emit(ON_REFRESH_DATA)\r\n              baseDialog._afterDialogClose()\r\n              console.log('[kalix] dialog submit button clicked !')\r\n              baseDialog.visible = false\r\n            })\r\n          } else {\r\n            Message.error('请检查输入项！')\r\n            baseDialog.submitComplete()\r\n            return false\r\n          }\r\n        })\r\n        this.ids = []\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\n\n\n// WEBPACK FOOTER //\n// src/views/admin/role/roleAuth.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('kalix-dialog',{ref:\"kalixBizDialog\",staticClass:\"user-add\",attrs:{\"title\":\"权限分配\",\"bizKey\":\"role\",\"formModel\":_vm.formModel,\"targetURL\":_vm.targetURL,\"submitCustom\":_vm.submitCustom},on:{\"update:formModel\":function($event){_vm.formModel=$event}}},[_c('div',{staticClass:\"el-form\",staticStyle:{\"max-height\":\"550px\",\"min-height\":\"550px\",\"overflow\":\"auto\",\"border\":\"1px solid #d0d0d0\",\"margin\":\"-30px 0 -20px\"},attrs:{\"slot\":\"dialogFormSlot\"},slot:\"dialogFormSlot\"},[_c('el-tree',{ref:\"baseTree\",staticClass:\"filter-tree\",attrs:{\"data\":_vm.treeData,\"props\":_vm.defaultProps,\"node-key\":\"id\",\"highlight-current\":\"highlight-current\",\"show-checkbox\":\"show-checkbox\",\"default-checked-keys\":_vm.checkedKeys,\"default-expand-all\":\"default-expand-all\",\"empty-text\":\"数据加载中!\"},on:{\"check-change\":_vm.checkChange}})],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-a4d146b8\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/template-compiler/preprocessor.js?engine=pug!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/admin/role/roleAuth.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./roleAuth.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-a4d146b8\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=pug!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./roleAuth.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/admin/role/roleAuth.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}